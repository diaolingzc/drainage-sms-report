import{_ as K,c as h,a as i,w as r,r as m,d as x,o as p,b as f,e as _,F as b,f as w,h as v,g as y}from"./index-BCKM321f.js";import{d as g}from"./db-Cg9-o0fH.js";const z={name:"LinkManagement",data(){return{linkList:[],loading:!1,pagination:{current:1,pageSize:10,total:0,showJumper:!0,showPageSize:!0,pageSizeOptions:[10,20,50]},columns:[{colKey:"id",title:"ID",width:80},{colKey:"type",title:"链接类型",width:120},{colKey:"short_url",title:"短信链接",width:200},{colKey:"long_url",title:"长链接",width:200},{colKey:"domain",title:"备案域名",width:150},{colKey:"is_domain_registered",title:"网址页面是否备案",width:150},{colKey:"icp_number",title:"ICP备案号",width:150},{colKey:"icp_screenshot",title:"ICP备案截图",width:150},{colKey:"icp_enterprise_name",title:"ICP备案企业名称",width:200},{colKey:"icp_enterprise_credit_code",title:"ICP备案企业社会统一信用代码",width:200},{colKey:"created_at",title:"创建时间",width:160,cell:(a,{row:e})=>this.$formatDate(e.created_at)},{colKey:"updated_at",title:"更新时间",width:160,cell:(a,{row:e})=>this.$formatDate(e.updated_at)},{colKey:"operation",title:"操作",fixed:"right",width:120}],searchForm:{type:"",domain:"",icp_enterprise_name:""},dialogVisible:!1,isEdit:!1,formData:{type:"2",short_url:"",long_url:"",domain:"",is_domain_registered:!1,icp_number:"",icp_screenshot:"",icp_enterprise_name:"",icp_enterprise_credit_code:""},rules:{type:[{required:!0,message:"请选择链接类型",type:"error"}],short_url:[{required:!0,message:"请输入短信链接",type:"error"}],long_url:[{required:!0,message:"请输入长链接",type:"error"}],domain:[{required:!0,message:"请输入备案域名",type:"error"}],is_domain_registered:[{required:!0,message:"请选择是否备案",type:"error"}],icp_number:[{required:!0,message:"请输入ICP备案号",type:"error"}],icp_screenshot:[{required:!0,message:"请上传ICP备案截图",type:"error"}],icp_enterprise_name:[{required:!0,message:"请输入ICP备案企业名称",type:"error"}],icp_enterprise_credit_code:[{required:!0,message:"请输入ICP备案企业社会统一信用代码",type:"error"}]},typeOptions:[{value:"1",label:"IP类型链接"},{value:"2",label:"域名类型链接"}],deleteDialogVisible:!1,currentDeleteId:null}},mounted(){this.loadLinks()},methods:{async loadLinks(){this.loading=!0;try{let e=await g.getAll("links");this.searchForm.type&&(e=e.filter(t=>t.type===this.searchForm.type)),this.searchForm.domain&&(e=e.filter(t=>t.domain.includes(this.searchForm.domain))),this.searchForm.icp_enterprise_name&&(e=e.filter(t=>t.icp_enterprise_name&&t.icp_enterprise_name.includes(this.searchForm.icp_enterprise_name)));const d=(this.pagination.current-1)*this.pagination.pageSize,o=d+this.pagination.pageSize;this.linkList=e.slice(d,o),this.pagination.total=e.length,this.loading=!1}catch(a){console.error("加载链接数据失败:",a),this.loading=!1}},searchLinks(){this.pagination.current=1,this.loadLinks()},onPageChange(a){this.pagination.current=a.current,this.pagination.pageSize=a.pageSize,this.loadLinks()},showCreateDialog(){this.isEdit=!1,this.formData={type:"2",short_url:"",long_url:"",domain:"",is_domain_registered:!1,icp_number:"",icp_screenshot:"",icp_enterprise_name:"",icp_enterprise_credit_code:""},this.dialogVisible=!0},editLink(a){this.isEdit=!0,this.formData={...a},this.dialogVisible=!0},deleteLink(a){this.currentDeleteId=a.id,this.deleteDialogVisible=!0},async confirmDelete(){if(this.currentDeleteId!==null)try{await g.remove("links",this.currentDeleteId),this.$message.success("删除成功"),this.deleteDialogVisible=!1,this.currentDeleteId=null,this.loadLinks()}catch(a){console.error("删除链接失败:",a),this.$message.error("删除失败")}},triggerUpload(){this.$refs.fileInput.click()},handleFileChange(a){const e=a.target.files[0];if(!e)return;const d=new FileReader;d.onload=o=>{this.formData.icp_screenshot=o.target.result},d.onerror=()=>{this.$message.error("图片读取失败")},d.readAsDataURL(e)},async submitForm({validateResult:a,firstError:e}){if(!a){this.$message.error(e);return}const d=x().format("YYYY/MM/DD HH:mm:ss"),o={...this.formData};o.type==="1"&&(o.is_domain_registered=!1,o.icp_number="",o.icp_screenshot="",o.icp_enterprise_name="",o.icp_enterprise_credit_code="");try{this.isEdit?(o.updated_at=d,await g.put("links",o),this.$message.success("更新成功")):(o.created_at=d,o.updated_at=d,await g.add("links",o),this.$message.success("创建成功")),this.dialogVisible=!1,this.loadLinks()}catch(t){console.error("提交链接失败:",t),this.$message.error("提交失败")}}}},S={class:"link-management"},q={class:"operation-bar"},E={class:"left"},B={class:"right"},M=["src"],N=["src"];function O(a,e,d,o,t,n){const c=m("t-button"),C=m("t-option"),k=m("t-select"),s=m("t-form-item"),u=m("t-input"),V=m("t-form"),D=m("t-space"),L=m("t-table"),P=m("t-switch"),I=m("t-dialog"),F=m("t-card");return p(),h("div",S,[i(F,{title:"链接管理"},{default:r(()=>[f("div",q,[f("div",E,[i(c,{theme:"primary",onClick:n.showCreateDialog},{default:r(()=>e[16]||(e[16]=[_("添加链接")])),_:1,__:[16]},8,["onClick"])]),f("div",B,[i(V,{data:t.searchForm,layout:"inline"},{default:r(()=>[i(s,{label:"链接类型"},{default:r(()=>[i(k,{modelValue:t.searchForm.type,"onUpdate:modelValue":e[0]||(e[0]=l=>t.searchForm.type=l),placeholder:"请选择链接类型",clearable:"",onChange:n.searchLinks,onClear:n.searchLinks},{default:r(()=>[(p(!0),h(b,null,w(t.typeOptions,l=>(p(),v(C,{key:l.value,value:l.value,label:l.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue","onChange","onClear"])]),_:1}),i(s,{label:"备案域名"},{default:r(()=>[i(u,{modelValue:t.searchForm.domain,"onUpdate:modelValue":e[1]||(e[1]=l=>t.searchForm.domain=l),clearable:"",placeholder:"请输入备案域名",onChange:n.searchLinks,onClear:n.searchLinks},null,8,["modelValue","onChange","onClear"])]),_:1}),i(s,{label:"ICP备案企业名称"},{default:r(()=>[i(u,{modelValue:t.searchForm.icp_enterprise_name,"onUpdate:modelValue":e[2]||(e[2]=l=>t.searchForm.icp_enterprise_name=l),clearable:"",placeholder:"请输入ICP备案企业名称",onChange:n.searchLinks,onClear:n.searchLinks},null,8,["modelValue","onChange","onClear"])]),_:1}),i(s,null,{default:r(()=>[i(c,{theme:"primary",onClick:n.searchLinks},{default:r(()=>e[17]||(e[17]=[_("查询")])),_:1,__:[17]},8,["onClick"])]),_:1})]),_:1},8,["data"])])]),i(L,{data:t.linkList,columns:t.columns,loading:t.loading,pagination:t.pagination,onPageChange:n.onPageChange,stripe:"","row-key":"id",class:"link-table"},{icp_screenshot:r(({row:l})=>[l.icp_screenshot?(p(),h("img",{key:0,src:l.icp_screenshot,alt:"ICP备案截图",style:{width:"100px",height:"auto"}},null,8,M)):y("",!0)]),operation:r(({row:l})=>[i(D,{size:"small"},{default:r(()=>[i(c,{theme:"primary",size:"small",onClick:U=>n.editLink(l)},{default:r(()=>e[18]||(e[18]=[_("编辑")])),_:2,__:[18]},1032,["onClick"]),i(c,{theme:"danger",size:"small",onClick:U=>n.deleteLink(l)},{default:r(()=>e[19]||(e[19]=[_("删除")])),_:2,__:[19]},1032,["onClick"])]),_:2},1024)]),_:1},8,["data","columns","loading","pagination","onPageChange"]),i(I,{visible:t.dialogVisible,"onUpdate:visible":e[14]||(e[14]=l=>t.dialogVisible=l),header:t.isEdit?"编辑链接":"添加链接",width:"600px",footer:!1},{default:r(()=>[i(V,{ref:"linkForm",data:t.formData,rules:t.rules,"label-width":"150px",onSubmit:n.submitForm},{default:r(()=>[i(s,{label:"链接类型",name:"type"},{default:r(()=>[i(k,{modelValue:t.formData.type,"onUpdate:modelValue":e[3]||(e[3]=l=>t.formData.type=l),placeholder:"请选择链接类型"},{default:r(()=>[(p(!0),h(b,null,w(t.typeOptions,l=>(p(),v(C,{key:l.value,value:l.value,label:l.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),i(s,{label:"短信链接",name:"short_url"},{default:r(()=>[i(u,{modelValue:t.formData.short_url,"onUpdate:modelValue":e[4]||(e[4]=l=>t.formData.short_url=l),placeholder:"短信内容中的完整链接案例，填写一个案例即可"},null,8,["modelValue"])]),_:1}),i(s,{label:"长链接",name:"long_url"},{default:r(()=>[i(u,{modelValue:t.formData.long_url,"onUpdate:modelValue":e[5]||(e[5]=l=>t.formData.long_url=l),placeholder:"短信内容中的完整链接案例（若该链接为短链，此处填写跳转后的最终网址）"},null,8,["modelValue"])]),_:1}),i(s,{label:"备案域名",name:"domain"},{default:r(()=>[i(u,{modelValue:t.formData.domain,"onUpdate:modelValue":e[6]||(e[6]=l=>t.formData.domain=l),placeholder:"请填写备案域名，IP请填写完整IP"},null,8,["modelValue"])]),_:1}),t.formData.type==="2"?(p(),h(b,{key:0},[i(s,{label:"网址页面是否备案",name:"is_domain_registered"},{default:r(()=>[i(P,{modelValue:t.formData.is_domain_registered,"onUpdate:modelValue":e[7]||(e[7]=l=>t.formData.is_domain_registered=l),label:["是","否"]},null,8,["modelValue"])]),_:1}),i(s,{label:"ICP备案号",name:"icp_number"},{default:r(()=>[i(u,{modelValue:t.formData.icp_number,"onUpdate:modelValue":e[8]||(e[8]=l=>t.formData.icp_number=l),placeholder:"请输入ICP备案号"},null,8,["modelValue"])]),_:1}),i(s,{label:"ICP备案截图",name:"icp_screenshot"},{default:r(()=>[i(u,{modelValue:t.formData.icp_screenshot,"onUpdate:modelValue":e[9]||(e[9]=l=>t.formData.icp_screenshot=l),placeholder:"请上传ICP备案截图",readonly:""},null,8,["modelValue"]),i(c,{type:"button",onClick:n.triggerUpload},{default:r(()=>e[20]||(e[20]=[_("上传图片")])),_:1,__:[20]},8,["onClick"]),f("input",{type:"file",ref:"fileInput",onChange:e[10]||(e[10]=(...l)=>n.handleFileChange&&n.handleFileChange(...l)),accept:"image/*",style:{display:"none"}},null,544),t.formData.icp_screenshot?(p(),h("img",{key:0,src:t.formData.icp_screenshot,alt:"ICP备案截图预览",style:{"max-width":"200px","margin-top":"10px"}},null,8,N)):y("",!0)]),_:1}),i(s,{label:"ICP备案企业名称",name:"icp_enterprise_name"},{default:r(()=>[i(u,{modelValue:t.formData.icp_enterprise_name,"onUpdate:modelValue":e[11]||(e[11]=l=>t.formData.icp_enterprise_name=l),placeholder:"请输入ICP备案企业名称"},null,8,["modelValue"])]),_:1}),i(s,{label:"ICP备案企业社会统一信用代码",name:"icp_enterprise_credit_code"},{default:r(()=>[i(u,{modelValue:t.formData.icp_enterprise_credit_code,"onUpdate:modelValue":e[12]||(e[12]=l=>t.formData.icp_enterprise_credit_code=l),placeholder:"请输入ICP备案企业社会统一信用代码"},null,8,["modelValue"])]),_:1})],64)):y("",!0),i(s,null,{default:r(()=>[i(D,null,{default:r(()=>[i(c,{theme:"primary",type:"submit"},{default:r(()=>e[21]||(e[21]=[_("确定")])),_:1,__:[21]}),i(c,{theme:"default",variant:"base",onClick:e[13]||(e[13]=l=>t.dialogVisible=!1)},{default:r(()=>e[22]||(e[22]=[_("取消")])),_:1,__:[22]})]),_:1})]),_:1})]),_:1},8,["data","rules","onSubmit"])]),_:1},8,["visible","header"]),i(I,{visible:t.deleteDialogVisible,"onUpdate:visible":e[15]||(e[15]=l=>t.deleteDialogVisible=l),header:"删除确认",body:"确定要删除该链接吗？","on-confirm":n.confirmDelete,"on-cancel":()=>t.deleteDialogVisible=!1},null,8,["visible","on-confirm","on-cancel"])]),_:1})])}const H=K(z,[["render",O],["__scopeId","data-v-3ea6a796"]]);export{H as default};
