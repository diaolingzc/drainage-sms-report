import{_ as Y,c as g,a as l,w as a,r as m,d as q,o as p,b as y,e as b,F as N,f as z,h as F,i as f,v as h}from"./index-BCKM321f.js";import{d as c}from"./db-Cg9-o0fH.js";const E={name:"NumberManagement",data(){return{numberList:[],loading:!1,pagination:{current:1,pageSize:10,total:0,showJumper:!0,showPageSize:!0,pageSizeOptions:[10,20,50]},columns:[{colKey:"id",title:"ID",width:80},{colKey:"type",title:"号码类型",width:120},{colKey:"number",title:"具体号码",width:150},{colKey:"organization",title:"所属单位",width:200},{colKey:"owner_name",title:"所属人姓名"},{colKey:"owner_id_type",title:"所属人证件类型"},{colKey:"owner_id_number",title:"所属人证件号码"},{colKey:"test_time",title:"拨测时间",width:180},{colKey:"is_recorded",title:"是否录音",cell:(o,{row:e})=>e.is_recorded?"是":"否"},{colKey:"created_at",title:"创建时间",width:180,cell:(o,{row:e})=>this.$formatDate(e.created_at)},{colKey:"updated_at",title:"更新时间",width:180,cell:(o,{row:e})=>this.$formatDate(e.updated_at)},{colKey:"operation",title:"操作",fixed:"right",width:120}],searchForm:{type:"",number:"",organization:"",owner_name:""},dialogVisible:!1,isEdit:!1,formData:{type:"",number:"",organization:"",owner_name:"",owner_id_type:"身份证",owner_id_number:"",test_time:"",is_recorded:!1},rules:{type:[{required:!0,message:"请选择号码类型",type:"error"}],number:[{required:!0,message:"请输入具体号码",type:"error"}],organization:[{required:!0,message:"请输入所属单位",type:"error"}],owner_name:[{required:!0,message:"请输入所属人姓名",type:"error"}],owner_id_type:[{required:!0,message:"请选择所属人证件类型",type:"error"}],owner_id_number:[{required:!0,message:"请输入所属人证件号码",type:"error"}],test_time:[{required:!0,message:"请选择拨测时间",type:"error"}]},typeOptions:[{value:"1",label:"手机号"},{value:"2",label:"固话"},{value:"3",label:"400电话"},{value:"4",label:"800电话"},{value:"5",label:"95开头号码"},{value:"6",label:"96开头号码"},{value:"7",label:"1开头号码（非手机号码）"}],deleteDialogVisible:!1,currentDeleteId:null}},mounted(){this.loadNumbers()},methods:{async loadNumbers(){this.loading=!0;try{let e=await c.getAll("numbers");this.searchForm.type&&(e=e.filter(t=>t.type===this.searchForm.type)),this.searchForm.number&&(e=e.filter(t=>t.number.includes(this.searchForm.number))),this.searchForm.organization&&(e=e.filter(t=>t.organization&&t.organization.includes(this.searchForm.organization))),this.searchForm.owner_name&&(e=e.filter(t=>t.owner_name&&t.owner_name.includes(this.searchForm.owner_name)));const d=(this.pagination.current-1)*this.pagination.pageSize,s=d+this.pagination.pageSize;this.numberList=e.slice(d,s),this.pagination.total=e.length,this.loading=!1}catch(o){console.error("加载号码数据失败:",o),this.loading=!1}},searchNumbers(){this.pagination.current=1,this.loadNumbers()},onPageChange(o){this.pagination.current=o.current,this.pagination.pageSize=o.pageSize,this.loadNumbers()},showCreateDialog(){this.isEdit=!1,this.formData={type:"",number:"",organization:"",owner_name:"",owner_id_type:"身份证",owner_id_number:"",test_time:"",is_recorded:!1},this.dialogVisible=!0},editNumber(o){this.isEdit=!0,this.formData={...o},this.dialogVisible=!0},deleteNumber(o){this.currentDeleteId=o.id,this.deleteDialogVisible=!0},async confirmDelete(){if(this.currentDeleteId!==null)try{await c.remove("numbers",this.currentDeleteId),this.$message.success("删除成功"),this.deleteDialogVisible=!1,this.currentDeleteId=null,this.loadNumbers()}catch(o){console.error("删除号码失败:",o),this.$message.error("删除失败")}},handleTypeChange(o){o==="1"?this.formData.organization="":(this.formData.owner_name="",this.formData.owner_id_number="")},async submitForm({validateResult:o,firstError:e}){if(!o){this.$message.error(e);return}const d=q().format("YYYY/MM/DD HH:mm:ss"),s={...this.formData};if(s.type==="1"){if(!s.owner_name||!s.owner_id_number){this.$message.error("手机号类型必须填写所属人信息");return}}else if(!s.organization){this.$message.error("非手机号类型必须填写所属单位");return}try{this.isEdit?(s.updated_at=d,await c.put("numbers",s),this.$message.success("更新成功")):(s.created_at=d,s.updated_at=d,await c.add("numbers",s),this.$message.success("创建成功")),this.dialogVisible=!1,this.loadNumbers()}catch(t){console.error("提交号码失败:",t),this.$message.error("提交失败")}}}},I={class:"number-management"},M={class:"operation-bar"},P={class:"left"},B={class:"right"};function H(o,e,d,s,t,n){const _=m("t-button"),w=m("t-option"),V=m("t-select"),i=m("t-form-item"),u=m("t-input"),D=m("t-form"),v=m("t-space"),k=m("t-table"),U=m("t-date-picker"),K=m("t-switch"),C=m("t-dialog"),S=m("t-card");return p(),g("div",I,[l(S,{title:"号码管理"},{default:a(()=>[y("div",M,[y("div",P,[l(_,{theme:"primary",onClick:n.showCreateDialog},{default:a(()=>e[15]||(e[15]=[b("添加号码")])),_:1,__:[15]},8,["onClick"])]),y("div",B,[l(D,{data:t.searchForm,layout:"inline"},{default:a(()=>[l(i,{label:"号码类型"},{default:a(()=>[l(V,{modelValue:t.searchForm.type,"onUpdate:modelValue":e[0]||(e[0]=r=>t.searchForm.type=r),placeholder:"请选择号码类型",clearable:"",onChange:n.searchNumbers,onClear:n.searchNumbers},{default:a(()=>[(p(!0),g(N,null,z(t.typeOptions,r=>(p(),F(w,{key:r.value,value:r.value,label:r.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue","onChange","onClear"])]),_:1}),l(i,{label:"具体号码"},{default:a(()=>[l(u,{modelValue:t.searchForm.number,"onUpdate:modelValue":e[1]||(e[1]=r=>t.searchForm.number=r),clearable:"",placeholder:"请输入具体号码",onChange:n.searchNumbers,onClear:n.searchNumbers},null,8,["modelValue","onChange","onClear"])]),_:1}),l(i,{label:"所属单位"},{default:a(()=>[l(u,{modelValue:t.searchForm.organization,"onUpdate:modelValue":e[2]||(e[2]=r=>t.searchForm.organization=r),clearable:"",placeholder:"请输入所属单位",onChange:n.searchNumbers,onClear:n.searchNumbers},null,8,["modelValue","onChange","onClear"])]),_:1}),l(i,{label:"所属人姓名"},{default:a(()=>[l(u,{modelValue:t.searchForm.owner_name,"onUpdate:modelValue":e[3]||(e[3]=r=>t.searchForm.owner_name=r),clearable:"",placeholder:"请输入所属人姓名",onChange:n.searchNumbers,onClear:n.searchNumbers},null,8,["modelValue","onChange","onClear"])]),_:1}),l(i,null,{default:a(()=>[l(_,{theme:"primary",onClick:n.searchNumbers},{default:a(()=>e[16]||(e[16]=[b("查询")])),_:1,__:[16]},8,["onClick"])]),_:1})]),_:1},8,["data"])])]),l(k,{data:t.numberList,columns:t.columns,loading:t.loading,pagination:t.pagination,onPageChange:n.onPageChange,stripe:"","row-key":"id",class:"number-table"},{operation:a(({row:r})=>[l(v,{size:"small"},{default:a(()=>[l(_,{theme:"primary",size:"small",onClick:x=>n.editNumber(r)},{default:a(()=>e[17]||(e[17]=[b("编辑")])),_:2,__:[17]},1032,["onClick"]),l(_,{theme:"danger",size:"small",onClick:x=>n.deleteNumber(r)},{default:a(()=>e[18]||(e[18]=[b("删除")])),_:2,__:[18]},1032,["onClick"])]),_:2},1024)]),_:1},8,["data","columns","loading","pagination","onPageChange"]),l(C,{visible:t.dialogVisible,"onUpdate:visible":e[13]||(e[13]=r=>t.dialogVisible=r),header:t.isEdit?"编辑号码":"添加号码",width:"600px",footer:!1},{default:a(()=>[l(D,{ref:"numberForm",data:t.formData,rules:t.rules,"label-width":"150px",onSubmit:n.submitForm},{default:a(()=>[l(i,{label:"号码类型",name:"type"},{default:a(()=>[l(V,{modelValue:t.formData.type,"onUpdate:modelValue":e[4]||(e[4]=r=>t.formData.type=r),placeholder:"请选择号码类型",onChange:n.handleTypeChange},{default:a(()=>[(p(!0),g(N,null,z(t.typeOptions,r=>(p(),F(w,{key:r.value,value:r.value,label:r.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue","onChange"])]),_:1}),l(i,{label:"具体号码",name:"number"},{default:a(()=>[l(u,{modelValue:t.formData.number,"onUpdate:modelValue":e[5]||(e[5]=r=>t.formData.number=r),placeholder:"请输入具体号码"},null,8,["modelValue"])]),_:1}),f(l(i,{label:"所属单位",name:"organization"},{default:a(()=>[l(u,{modelValue:t.formData.organization,"onUpdate:modelValue":e[6]||(e[6]=r=>t.formData.organization=r),placeholder:"请输入所属单位"},null,8,["modelValue"])]),_:1},512),[[h,t.formData.type!=="1"]]),f(l(i,{label:"所属人姓名",name:"owner_name"},{default:a(()=>[l(u,{modelValue:t.formData.owner_name,"onUpdate:modelValue":e[7]||(e[7]=r=>t.formData.owner_name=r),placeholder:"请输入所属人姓名"},null,8,["modelValue"])]),_:1},512),[[h,t.formData.type==="1"]]),f(l(i,{label:"所属人证件类型",name:"owner_id_type"},{default:a(()=>[l(u,{modelValue:t.formData.owner_id_type,"onUpdate:modelValue":e[8]||(e[8]=r=>t.formData.owner_id_type=r),placeholder:"身份证",disabled:""},null,8,["modelValue"])]),_:1},512),[[h,t.formData.type==="1"]]),f(l(i,{label:"所属人证件号码",name:"owner_id_number"},{default:a(()=>[l(u,{modelValue:t.formData.owner_id_number,"onUpdate:modelValue":e[9]||(e[9]=r=>t.formData.owner_id_number=r),placeholder:"请输入所属人证件号码"},null,8,["modelValue"])]),_:1},512),[[h,t.formData.type==="1"]]),l(i,{label:"拨测时间",name:"test_time"},{default:a(()=>[l(U,{modelValue:t.formData.test_time,"onUpdate:modelValue":e[10]||(e[10]=r=>t.formData.test_time=r),mode:"date","enable-time-picker":"",format:"YYYY/MM/DD HH:mm:ss",placeholder:"请选择拨测时间"},null,8,["modelValue"])]),_:1}),l(i,{label:"电话拨测是否录音",name:"is_recorded"},{default:a(()=>[l(K,{modelValue:t.formData.is_recorded,"onUpdate:modelValue":e[11]||(e[11]=r=>t.formData.is_recorded=r),"custom-value":[!0,!1],label:["是","否"]},null,8,["modelValue"])]),_:1}),l(i,null,{default:a(()=>[l(v,null,{default:a(()=>[l(_,{theme:"primary",type:"submit"},{default:a(()=>e[19]||(e[19]=[b("确定")])),_:1,__:[19]}),l(_,{theme:"default",variant:"base",onClick:e[12]||(e[12]=r=>t.dialogVisible=!1)},{default:a(()=>e[20]||(e[20]=[b("取消")])),_:1,__:[20]})]),_:1})]),_:1})]),_:1},8,["data","rules","onSubmit"])]),_:1},8,["visible","header"]),l(C,{visible:t.deleteDialogVisible,"onUpdate:visible":e[14]||(e[14]=r=>t.deleteDialogVisible=r),header:"删除确认",body:"确定要删除该号码吗？","on-confirm":n.confirmDelete,"on-cancel":()=>t.deleteDialogVisible=!1},null,8,["visible","on-confirm","on-cancel"])]),_:1})])}const T=Y(E,[["render",H],["__scopeId","data-v-0d54516c"]]);export{T as default};
