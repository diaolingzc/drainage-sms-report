import{_ as K,c as f,a as r,w as s,r as i,d as z,o as c,b,e as _,F as v,f as C,h as w}from"./index-BCKM321f.js";import{d as g}from"./db-Cg9-o0fH.js";const P={name:"SignatureManagement",data(){return{signatureList:[],loading:!1,pagination:{current:1,pageSize:10,total:0,showJumper:!0,showPageSize:!0,pageSizeOptions:[10,20,50]},columns:[{colKey:"id",title:"ID",width:80},{colKey:"content",title:"签名内容",width:120},{colKey:"source",title:"签名来源",width:120},{colKey:"enterprise_name",title:"企业名称",width:200},{colKey:"enterprise_credit_code",title:"企业统一社会信用代码",width:200},{colKey:"responsible_person",title:"管理员名称"},{colKey:"responsible_person_id_type",title:"管理员证件类型"},{colKey:"responsible_person_id_number",title:"管理员证件号码"},{colKey:"created_at",title:"创建时间",width:120,cell:(o,{row:e})=>this.$formatDate(e.created_at)},{colKey:"updated_at",title:"更新时间",width:120,cell:(o,{row:e})=>this.$formatDate(e.updated_at)},{colKey:"operation",title:"操作",fixed:"right",width:120}],searchForm:{content:"",source:"",enterprise_name:""},dialogVisible:!1,isEdit:!1,formData:{content:"",source:"",enterprise_name:"",enterprise_credit_code:"",responsible_person:"",responsible_person_id_type:"身份证",responsible_person_id_number:""},rules:{content:[{required:!0,message:"请输入签名内容",type:"error"}],source:[{required:!0,message:"请选择签名来源",type:"error"}],enterprise_name:[{required:!0,message:"请输入企业名称",type:"error"}],enterprise_credit_code:[{required:!0,message:"请输入企业统一社会信用代码",type:"error"}],responsible_person:[{required:!0,message:"请输入管理员名称",type:"error"}],responsible_person_id_type:[{required:!0,message:"请选择管理员证件类型",type:"error"}],responsible_person_id_number:[{required:!0,message:"请输入管理员证件号码",type:"error"}]},sourceOptions:[{value:"公司全称",label:"公司全称"},{value:"公司简称",label:"公司简称"},{value:"APP",label:"APP"},{value:"商标",label:"商标"}],deleteDialogVisible:!1,currentDeleteId:null}},mounted(){this.loadSignatures()},methods:{async loadSignatures(){this.loading=!0;try{let e=await g.getAll("signatures");this.searchForm.content&&(e=e.filter(t=>t.content.includes(this.searchForm.content))),this.searchForm.source&&(e=e.filter(t=>t.source===this.searchForm.source)),this.searchForm.enterprise_name&&(e=e.filter(t=>t.enterprise_name.includes(this.searchForm.enterprise_name)));const m=(this.pagination.current-1)*this.pagination.pageSize,u=m+this.pagination.pageSize;this.signatureList=e.slice(m,u),this.pagination.total=e.length,this.loading=!1}catch(o){console.error("加载签名数据失败:",o),this.loading=!1}},searchSignatures(){this.pagination.current=1,this.loadSignatures()},onPageChange(o){this.pagination.current=o.current,this.pagination.pageSize=o.pageSize,this.loadSignatures()},showCreateDialog(){this.isEdit=!1,this.formData={content:"",source:"",enterprise_name:"",enterprise_credit_code:"",responsible_person:"",responsible_person_id_type:"身份证",responsible_person_id_number:""},this.dialogVisible=!0},editSignature(o){this.isEdit=!0,this.formData={...o},this.dialogVisible=!0},deleteSignature(o){this.currentDeleteId=o.id,this.deleteDialogVisible=!0},async confirmDelete(){if(this.currentDeleteId!==null)try{await g.remove("signatures",this.currentDeleteId),this.$message.success("删除成功"),this.deleteDialogVisible=!1,this.currentDeleteId=null,this.loadSignatures()}catch(o){console.error("删除签名失败:",o),this.$message.error("删除失败")}},async submitForm({validateResult:o,firstError:e}){if(!o){this.$message.error(e);return}const m=z().format("YYYY/MM/DD HH:mm:ss"),u={...this.formData};try{this.isEdit?(u.updated_at=m,await g.put("signatures",u),this.$message.success("更新成功")):(u.created_at=m,u.updated_at=m,await g.add("signatures",u),this.$message.success("创建成功")),this.dialogVisible=!1,this.loadSignatures()}catch(t){console.error("提交签名失败:",t),this.$message.error("提交失败")}},formatDate(o){return Date.parse(o).toString("yyyy/MM/dd HH:mm:ss")}}},x={class:"signature-management"},q={class:"operation-bar"},E={class:"left"},I={class:"right"};function M(o,e,m,u,t,a){const p=i("t-button"),d=i("t-input"),n=i("t-form-item"),h=i("t-option"),y=i("t-select"),V=i("t-form"),D=i("t-space"),F=i("t-table"),S=i("t-dialog"),k=i("t-card");return c(),f("div",x,[r(k,{title:"签名管理"},{default:s(()=>[b("div",q,[b("div",E,[r(p,{theme:"primary",onClick:a.showCreateDialog},{default:s(()=>e[13]||(e[13]=[_("创建签名")])),_:1,__:[13]},8,["onClick"])]),b("div",I,[r(V,{data:t.searchForm,layout:"inline"},{default:s(()=>[r(n,{label:"签名内容"},{default:s(()=>[r(d,{modelValue:t.searchForm.content,"onUpdate:modelValue":e[0]||(e[0]=l=>t.searchForm.content=l),clearable:"",placeholder:"请输入签名内容",onChange:a.searchSignatures,onClear:a.searchSignatures},null,8,["modelValue","onChange","onClear"])]),_:1}),r(n,{label:"签名来源"},{default:s(()=>[r(y,{modelValue:t.searchForm.source,"onUpdate:modelValue":e[1]||(e[1]=l=>t.searchForm.source=l),placeholder:"请选择签名来源",clearable:"",onChange:a.searchSignatures,onClear:a.searchSignatures},{default:s(()=>[(c(!0),f(v,null,C(t.sourceOptions,l=>(c(),w(h,{key:l.value,value:l.value,label:l.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue","onChange","onClear"])]),_:1}),r(n,{label:"企业名称"},{default:s(()=>[r(d,{modelValue:t.searchForm.enterprise_name,"onUpdate:modelValue":e[2]||(e[2]=l=>t.searchForm.enterprise_name=l),clearable:"",placeholder:"请输入企业名称",onChange:a.searchSignatures,onClear:a.searchSignatures},null,8,["modelValue","onChange","onClear"])]),_:1}),r(n,null,{default:s(()=>[r(p,{theme:"primary",onClick:a.searchSignatures},{default:s(()=>e[14]||(e[14]=[_("查询")])),_:1,__:[14]},8,["onClick"])]),_:1})]),_:1},8,["data"])])]),r(F,{data:t.signatureList,columns:t.columns,loading:t.loading,pagination:t.pagination,onPageChange:a.onPageChange,stripe:"","row-key":"id",class:"signature-table"},{operation:s(({row:l})=>[r(D,{size:"small"},{default:s(()=>[r(p,{theme:"primary",size:"small",onClick:U=>a.editSignature(l)},{default:s(()=>e[15]||(e[15]=[_("编辑")])),_:2,__:[15]},1032,["onClick"]),r(p,{theme:"danger",size:"small",onClick:U=>a.deleteSignature(l)},{default:s(()=>e[16]||(e[16]=[_("删除")])),_:2,__:[16]},1032,["onClick"])]),_:2},1024)]),_:1},8,["data","columns","loading","pagination","onPageChange"]),r(S,{visible:t.dialogVisible,"onUpdate:visible":e[11]||(e[11]=l=>t.dialogVisible=l),header:t.isEdit?"编辑签名":"创建签名",width:"600px",footer:!1},{default:s(()=>[r(V,{ref:"signatureForm",data:t.formData,rules:t.rules,"label-width":"150px",onSubmit:a.submitForm},{default:s(()=>[r(n,{label:"签名内容",name:"content"},{default:s(()=>[r(d,{modelValue:t.formData.content,"onUpdate:modelValue":e[3]||(e[3]=l=>t.formData.content=l),placeholder:"请输入签名内容"},null,8,["modelValue"])]),_:1}),r(n,{label:"签名来源",name:"source"},{default:s(()=>[r(y,{modelValue:t.formData.source,"onUpdate:modelValue":e[4]||(e[4]=l=>t.formData.source=l),placeholder:"请选择签名来源"},{default:s(()=>[(c(!0),f(v,null,C(t.sourceOptions,l=>(c(),w(h,{key:l.value,value:l.value,label:l.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),r(n,{label:"企业名称",name:"enterprise_name"},{default:s(()=>[r(d,{modelValue:t.formData.enterprise_name,"onUpdate:modelValue":e[5]||(e[5]=l=>t.formData.enterprise_name=l),placeholder:"请输入企业名称"},null,8,["modelValue"])]),_:1}),r(n,{label:"企业统一社会信用代码",name:"enterprise_credit_code"},{default:s(()=>[r(d,{modelValue:t.formData.enterprise_credit_code,"onUpdate:modelValue":e[6]||(e[6]=l=>t.formData.enterprise_credit_code=l),placeholder:"请输入企业统一社会信用代码"},null,8,["modelValue"])]),_:1}),r(n,{label:"管理员名称",name:"responsible_person"},{default:s(()=>[r(d,{modelValue:t.formData.responsible_person,"onUpdate:modelValue":e[7]||(e[7]=l=>t.formData.responsible_person=l),placeholder:"请输入管理员名称"},null,8,["modelValue"])]),_:1}),r(n,{label:"管理员证件类型",name:"responsible_person_id_type"},{default:s(()=>[r(d,{modelValue:t.formData.responsible_person_id_type,"onUpdate:modelValue":e[8]||(e[8]=l=>t.formData.responsible_person_id_type=l),placeholder:"身份证",disabled:""},null,8,["modelValue"])]),_:1}),r(n,{label:"管理员证件号码",name:"responsible_person_id_number"},{default:s(()=>[r(d,{modelValue:t.formData.responsible_person_id_number,"onUpdate:modelValue":e[9]||(e[9]=l=>t.formData.responsible_person_id_number=l),placeholder:"请输入管理员证件号码"},null,8,["modelValue"])]),_:1}),r(n,null,{default:s(()=>[r(D,null,{default:s(()=>[r(p,{theme:"primary",type:"submit"},{default:s(()=>e[17]||(e[17]=[_("确定")])),_:1,__:[17]}),r(p,{theme:"default",variant:"base",onClick:e[10]||(e[10]=l=>t.dialogVisible=!1)},{default:s(()=>e[18]||(e[18]=[_("取消")])),_:1,__:[18]})]),_:1})]),_:1})]),_:1},8,["data","rules","onSubmit"])]),_:1},8,["visible","header"]),r(S,{visible:t.deleteDialogVisible,"onUpdate:visible":e[12]||(e[12]=l=>t.deleteDialogVisible=l),header:"删除确认",body:"确定要删除该签名吗？","on-confirm":a.confirmDelete,"on-cancel":()=>t.deleteDialogVisible=!1},null,8,["visible","on-confirm","on-cancel"])]),_:1})])}const L=K(P,[["render",M],["__scopeId","data-v-b8817a41"]]);export{L as default};
